{{ define "worksheet" }}
  {{ template "header" . }}

  <section class="section">
    <div class="container">

      <h1 class="title is-3">Generate a Personlized Problem-Set</h1>

      <div class="box">
        <form id="worksheetForm" method="post">        <!-- ← plain form, no htmx -->

          <!-- Name -->
          <div class="field">
            <label class="label">Student name</label>
            <div class="control">
              <input class="input" type="text" name="name" placeholder="Alex" required>
            </div>
          </div>
          <!-- Gender -->
          <div class="field">
            <label class="label">Gender</label>
            <div class="control">
              <div class="select">
                <select name="gender" required>
                  <option value="Male">Male</option>
                  <option value="Female">Female</option>
                </select>
              </div>
            </div>
          </div>
          <!-- Operation -->
          <div class="field">
            <label class="label">Operation</label>
            <div class="control">
              <div class="select">
                <select name="operation" required>
                  <option value="Addition">addition</option>
                  <option value="Subtraction">subtraction</option>
                  <option value="Multiply">multiplication</option>
                  <option value="Divide">division</option>
                </select>
              </div>
            </div>
          </div>
        
          <!-- Number of problems -->
          <div class="field">
            <label class="label">Number of problems</label>
            <div class="control">
              <input class="input" type="number" name="numProblems" value="10" min="1" required>
            </div>
          </div>
        
          <!-- Skill Level -->
          <div class="field">
            <label class="label">Difficulty Level</label>
            <div class="control">
              <div class="select">
                <select name="gradeLevel" required>
                  <option value="Kindergarten">Kindergarten</option>
                  <option value="1st Grade">1st Grade</option>
                  <option value="2nd Grade">2nd Grade</option>
                  <option value="3rd Grade">3rd Grade</option>
                  <option value="4th Grade">4th Grade</option>
                  <option value="5th Grade">5th Grade</option>
                </select>
              </div>
            </div>
          </div>
        
          <!-- Likes nouns -->
          <div class="field">
            <label class="label">Favourite nouns <span class="has-text-grey">(comma separated)</span></label>
            <div class="control">
              <input class="input" type="text" name="likesNouns" placeholder="pizza, robots">
            </div>
          </div>
        
          <!-- Likes verbs -->
          <div class="field">
            <label class="label">Favourite verbs <span class="has-text-grey">(comma separated)</span></label>
            <div class="control">
              <input class="input" type="text" name="likesVerbs" placeholder="run, jump">
            </div>
          </div>
        
          <!-- Submit + spinner -->
          <div class="field">
            <div class="control">
              <div class="buttons">
                <button class="button is-primary"
                        type="button"
                        hx-post="/generatePDF"
                        hx-target="#status"
                        hx-indicator="#spinner"
                        hx-include="#worksheetForm">
                  PDF Worksheet
                </button>
              
                <button class="button is-link"
                        type="button"

                        hx-post="/generateInteractive"   
                        hx-target="body"                 
                        hx-include="#worksheetForm"      
                        hx-push-url="true"               
                        hx-on:click="this.setAttribute('disabled','');">
                  Interactive Worksheet
                </button>
              </div>
            </div>
          </div>
        </form>
    </div>
</div>
<div id="status"></div>
    </div>
</section>
<!-- Loading modal ------------------------------------------------------- -->
<div id="loadingModal" class="modal">
  <div class="modal-background"></div>

  <div class="modal-content">
    <!-- The Box gives us a white/light background + padding + shadow -->
    <div class="box has-text-centered p-6">
      <span class="icon is-large has-text-info">
        <i class="fas fa-spinner fa-pulse fa-3x"></i>
      </span>

      <p class="title is-5 mt-4 has-text-weight-semibold">
        Generating your problem set…
      </p>
    </div>
  </div>
</div>
<!-- /Loading modal ------------------------------------------------------ -->
<script>
  (function () {
    const modal = document.getElementById('loadingModal');

    // Show the modal before any htmx request originating on this page
    document.body.addEventListener('htmx:beforeRequest', (evt) => {
      // We only want the spinner for our PDF request, not for every htmx call
      if (evt.target.id === 'worksheetForm' || evt.target.closest('#worksheetForm')) {
        modal.classList.add('is-active');
      }
    });

    // Hide it after *any* response (success or failure)
    const hide = () => modal.classList.remove('is-active');
    document.body.addEventListener('htmx:afterRequest', hide);
    document.body.addEventListener('htmx:responseError', hide);
  })();
</script>
<!-- /Loading modal ------------------------------------------------------ -->
  {{ template "footer" . }}
{{ end }}

x
